package com.estock.batch;

import java.nio.file.Path;
import java.nio.file.Paths;

import org.springframework.batch.item.file.FlatFileItemReader;
import org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper;
import org.springframework.batch.item.file.mapping.DefaultLineMapper;
import org.springframework.batch.item.file.transform.DelimitedLineTokenizer;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.FileSystemResource;

import com.estock.model.DataFile;

public class OrdersReader extends FlatFileItemReader<DataFile> {


	@Value("${csvFilePath}")
	private String csvFilePath;

	public FlatFileItemReader<DataFile> createFlatFileItemReader() {
		Path filePath = Paths.get(this.csvFilePath, "eStock_Orders.csv");
		//setResource(new ClassPathResource(filePath.toString()));
		
		FlatFileItemReader<DataFile> flatFileItemReader = new FlatFileItemReader<>();
		flatFileItemReader.setResource(new FileSystemResource("c:\\eStock\\eStock_Orders.csv"));
		setLineMapper(new DefaultLineMapper<DataFile>() {{
            setLineTokenizer(new DelimitedLineTokenizer() {{
                setNames(new String[]{"orderId", "orderCustomer", "itemCode", "itemSoldQTY"});
            }});
            setFieldSetMapper(new BeanWrapperFieldSetMapper<DataFile>() {{
                setTargetType(DataFile.class);
            }});
        }});
		
        flatFileItemReader.setStrict(false);
        
        return flatFileItemReader;
	}
	
}
